<!DOCTYPE html>
<html>
<head>
     <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
</head>
<body>
    <form>
        <fieldset id="events_form">
            <legend>Pageview</legend>
            <p>
                <input type="checkbox" name="pageload" checked="checked" class="event-rule"
                    data-event-name="pageload"
                    disabled
                />
                <label for="onload">On page load</label>
            </p>
            <p>
                <input type="checkbox" name="url_change" checked="checked" class="event-rule"
                    data-event-name="url_change"
                    data-event-type="url_change"
                />
                <label for="url_change">On URL change</label>
            </p>
            <p>
                <input type="checkbox" name="url_change_match" class="event-rule"
                    data-event-name="url_change_match"
                    data-event-val="url_match_val" />
                <label for="url_match">URL match</label>
            </p>
            <p>
                <input type="text" value="" id="url_match_val" />
            </p>
            <p>
                <input type="checkbox" name="clicks[]" class="event-rule"
                    data-event-name="click"
                    data-event-val="click_val-c3" />
                <label for="url_match">Click</label>
            </p>
            <p>
                <input type="text" value="" id="click_val-c3" />
            </p>
        </fieldset>
        <p>
            <input type="button" id="add_click" value="Add click"></input>
        </p>
        <input type="button" id="save" value="Try on demo page"></input>
    </form>

    <p id="code_snippet"></p>

    <script>
        document.getElementById('add_click').addEventListener('click', function () {
            var rules_count = 1 + document.querySelectorAll('.event-rule').length;

            var p1 = document.createElement('p'),
                p2 = document.createElement('p');

            p1.innerHTML = `
                <p>
                    <input type="checkbox" name="clicks[]" class="event-rule"
                        data-event-name="click"
                        data-event-val="click_val-c` + rules_count + `" />
                    <label for="url_match">Click</label>
                </p>`;

            p2.innerHTML = `
                <p>
                    <input type="text" value="" id="click_val-c` + rules_count + `" />
                </p>`;

            document.getElementById('events_form').appendChild(p1).appendChild(p2);
        });

        document.getElementById('save').addEventListener('click', function () {
            var config = {};

            Array.prototype.forEach.call(document.querySelectorAll('.event-rule'), function (el) {
                var eventName,
                    eventValueId,
                    val;

                if (!el.checked) {
                    return;
                }

                eventName = el.getAttribute('data-event-name');
                eventValueId = el.getAttribute('data-event-val');
                val = eventValueId ? document.getElementById(eventValueId).value : null;

                if (eventName === 'click') {
                    if (!config.clicks) {
                        config.clicks = [];
                    }
                    if (val) {
                        config.clicks.push(val);
                    }
                } else {
                    config[eventName] = eventValueId ? val : true;
                }
            });
            document.getElementById('code_snippet').innerHTML = 'window.observer_events_config = ' +
                JSON.stringify(config) + ';';

            var demoUrl = window.location.protocol + '//' + window.location.host +
                '/abyrcheg/website-observer/demo.html' +
                encodeURI('?wsoc=' + JSON.stringify(config));

            window.location.href = demoUrl;
        });
    </script>
</body>
</html>